<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Employee List</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet" />

    <style>
        body {
            background-color: #f5f7fb;
        }
        .card-shadow {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body>

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Employee List</h2>

        <a href="add-employee.html" class="btn btn-success">+ Add Employee</a>
    </div>

    <div class="card card-shadow">
        <div class="card-body">

            <table class="table table-striped table-hover align-middle">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Email</th>
                    <th>Salary</th>
                    <th class="text-end">Actions</th>
                </tr>
                </thead>

                <tbody id="employeeTableBody">
                <tr><td colspan="6" class="text-center">Loading...</td></tr>
                </tbody>

            </table>

        </div>
    </div>

</div>


<!-- ===========================
      ðŸ”¥ FIXED SCRIPT SECTION  
=========================== -->
<script>
    const apiBase = "https://employeeapp-web-fcbkhdf7bvcnhmay.centralindia-01.azurewebsites.net/api/employees";
    const tableBody = document.getElementById("employeeTableBody");

    async function loadEmployees() {
        try {
            const response = await fetch(apiBase);
            const json = await response.json();

            if (!response.ok || json.status !== "success") {
                tableBody.innerHTML =
                  `<tr><td colspan="6" class="text-center text-danger">Failed to load employees</td></tr>`;
                return;
            }

            const employees = json.data;   // ðŸ”¥ Correct format

            tableBody.innerHTML = "";

            if (!employees || employees.length === 0) {
                tableBody.innerHTML =
                  `<tr><td colspan="6" class="text-center">No Employees Found</td></tr>`;
                return;
            }

            employees.forEach(emp => {
                tableBody.innerHTML += `
                    <tr>
                        <td>${emp.id}</td>
                        <td>${emp.name}</td>
                        <td>${emp.department}</td>
                        <td>${emp.email}</td>
                        <td>${emp.salary}</td>
                        <td class="text-end">
                            <a href="edit-employee.html?id=${emp.id}" class="btn btn-sm btn-primary">Edit</a>
                            <button class="btn btn-sm btn-danger ms-2" onclick="deleteEmployee(${emp.id})">Delete</button>
                        </td>
                    </tr>`;
            });

        } catch (err) {
            tableBody.innerHTML =
              `<tr><td colspan="6" class="text-center text-danger">Error: ${err.message}</td></tr>`;
        }
    }


    async function deleteEmployee(id) {
        if (!confirm("Are you sure you want to delete this employee?")) return;

        try {
            const response = await fetch(`${apiBase}/${id}`, {
                method: "DELETE"
            });
            const json = await response.json();

            if (!response.ok || json.status !== "success") {
                alert("Failed to delete employee");
                return;
            }

            alert("Employee deleted successfully");
            loadEmployees();

        } catch (err) {
            alert("Error: " + err.message);
        }
    }

    loadEmployees();
</script>

</body>
</html>
